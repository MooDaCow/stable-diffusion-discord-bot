# Stable Diffusion Discord Bot
forked from https://github.com/AndBobsYourUncle/stable-diffusion-discord-bot
at 2023-04-08T07:10:00 (JST)

この時点のやつをフォークした。Go言語もDiscordクライアントも初なので分かるところだけ自分用に進める

## 001. changed button order and icon captions
at iPhone Discord client, result buttons was not lined up

Dicordクライアントで見づらかったのでボタン配置とキャプションを変更した

![button orders before](https://github.com/pitapan5376/stable-diffusion-discord-bot/blob/master/document/001_change_button1.jpg?raw=true)

shorten caption and swap button orders like midjourney/nijijourney

![rearranged button order](https://github.com/pitapan5376/stable-diffusion-discord-bot/blob/master/document/001_change_button2.jpg?raw=true)

## 002. changed fonts
prompt showing in monospace in Discord client

打ち間違いとかするのでプロンプトはMonospaceで表示するようにした

![change prompt font to monospace](https://github.com/pitapan5376/stable-diffusion-discord-bot/blob/master/document/002_change_prompt_font.png?raw=true)


## enable aspect ratio (without upscaler)
--ar param is parsed and computed new values, but actual result was still default 512x512. 
new width, height is fed to Image Generation param.
this is not using upscalers nor hires.fix, --ar 1:2 gives you 512x1024 so requires enough GPU memory.

ソース内にアスペクト比の機能が書いてあったけど512x512のまま動作しなかったのでなんか計算されてた値を渡せるようにした。
素の値なのでGPU必要（hires.fixとかupscaleはされてないっぽい）

### 1girl --ar 4:3
![sample for ar 4:3](https://github.com/pitapan5376/stable-diffusion-discord-bot/blob/master/document/003_aspect_ratio_4_3.png?raw=true)

### 1girl --ar 1:2
![sample for ar 1:2](https://github.com/pitapan5376/stable-diffusion-discord-bot/blob/master/document/003_aspect_ratio_1_2.png?raw=true)


## add sampling steps
It seems difficult to add parameter like 'prompt:' on Discord ways, so I just copy & modified along --ar parameter.
with --step X gives you result in X steps processed. 
default value is 20, if not specified --step parameter. (sampling method is default Euler_a yet)

Discord風に prompt: とかでパラメータ渡すやり方が難しそうだったのでアスペクト比を取っているやつをコピーしてステップ数を渡せるようにした

### --step 7(512x512)
low steps at 7, seems noisy but It works.

![sample for step 7](https://github.com/pitapan5376/stable-diffusion-discord-bot/blob/master/document/004_steps_param_7.png?raw=true)

### --step 50 --ar 2:1(1024x768)
combo with aspect ratio, I could make AI output more detailed result. 

アスペクト比を横長とかにしたとき、ステップ数を増やすことができるようになったので、画像が荒くなくなった。

![sample for ar 1:2](https://github.com/pitapan5376/stable-diffusion-discord-bot/blob/master/document/004_steps_param_50.png?raw=true)

## add CFG scale parameter
passing CFG scale value. 1.0(min.) to 30.0(max.); the limit is along with AUTO1111 WebUI.

--cfgscale で CFGスケール値を渡せるようにした。数値の許容範囲はAUTO1111のWebUIにあわせた。

image is generated by random seed at current, it's little bit hard to check effectiveness of CFG values.

seedの指定がまだできないので簡単には比較できないが、極端な値にしたら絵柄変わったので多分動いている。

### --cfgscale 1.2
![sample for CFG scale low](https://github.com/pitapan5376/stable-diffusion-discord-bot/blob/master/document/005_cfg_scale_1.png?raw=true)

### --cfgscale 15.3
![sample for CFG scale high](https://github.com/pitapan5376/stable-diffusion-discord-bot/blob/master/document/005_cfg_scale_15.png?raw=true)

